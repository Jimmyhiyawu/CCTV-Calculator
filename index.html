<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›™å‘ç›£æ§è¨ˆç®—æ©Ÿ SIå¯¦æˆ°ç‰ˆ V4.2 (å®Œç¾æ¨£å¼ä¿®æ­£)</title>
    <style>
        :root { 
            --primary: #0f172a; 
            --accent: #2563eb; 
            --bg: #f8fafc; 
            --card: #ffffff; 
            --danger: #ef4444; 
        }
        body { font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; background: var(--bg); padding: 20px; margin:0; line-height: 1.5; }
        .container { width: 100%; max-width: 1240px; margin: 0 auto; background: var(--card); padding: 30px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.12); }

        header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #e2e8f0; padding-bottom: 20px; margin-bottom: 25px; }
        h2 { margin: 0; color: var(--primary); font-size: 1.9rem; display: flex; align-items: center; gap: 12px; }
        .badge { background: #dbeafe; color: #1e40af; padding: 8px 16px; border-radius: 30px; font-weight: bold; font-size: 0.95rem; }

        .mode-switcher { display: flex; background: #e2e8f0; padding: 8px; border-radius: 12px; margin-bottom: 25px; gap: 10px; }
        .mode-btn { flex: 1; padding: 16px; border: none; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 1.05rem; background: transparent; color: #64748b; transition: 0.3s; }
        .mode-btn.active { background: white; color: var(--accent); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }

        .input-section { background: #eff6ff; padding: 24px; border-radius: 14px; border: 2px solid #bfdbfe; margin-bottom: 25px; display: flex; align-items: center; justify-content: space-between; }
        .input-group label { font-size: 1.35rem; font-weight: 700; color: #1e40af; margin-right: 15px; }
        .input-group input { padding: 12px 0; border: 3px solid #60a5fa; border-radius: 12px; width: 160px; text-align: center; font-size: 2rem; font-weight: bold; color: var(--accent); }
        #inputUnit { font-size: 1.8rem; font-weight: bold; color: #1e40af; margin-left: 10px; }

        .table-responsive { overflow-x: auto; border-radius: 14px; box-shadow: 0 6px 20px rgba(0,0,0,0.1); margin-bottom: 25px; background: white; }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        th { background: #f1f5f9; color: #1e293b; padding: 18px 8px; font-weight: 700; text-align: center; font-size: 1rem; }
        td { padding: 7px 8px; border-bottom: 1px solid #e2e8f0; text-align: center; vertical-align: middle; }
        
        .cell { width: 100%; height: 52px; padding: 0 12px; border: 1.5px solid #cbd5e1; border-radius: 10px; font-size: 15px; box-sizing: border-box; }
        select.cell, input.cell { background: white; }
        
        /* ã€æ ¸å¿ƒä¿®æ­£ CSSã€‘
           é€™è£¡çµ±ä¸€äº† select èˆ‡ input çš„å­—å‹æ¨£å¼ï¼Œ
           text-align-last: center æ˜¯å°ˆé–€è§£æ±º Chrome ä¸‹æ‹‰é¸å–®ä¸ç½®ä¸­çš„èªæ³•ã€‚
        */
        .qty-style {
            text-align: center;
            text-align-last: center; /* è®“é¸ä¸­çš„é …ç›®åœ¨ Chrome ä¹Ÿèƒ½ç½®ä¸­ */
            font-size: 20px;         /* å­—é«”åŠ å¤§ */
            font-weight: 900;        /* ç²—é«” */
            color: #1e40af;          /* è—è‰² */
            cursor: pointer;
        }

        /* è®Šèº«å¾Œçš„æ‰‹å‹•è¼¸å…¥æ¡†æ¨£å¼ */
        .count-input-manual {
            background: #eff6ff !important;
            border-color: #60a5fa !important;
            cursor: text; /* è¼¸å…¥æ™‚æ¸¸æ¨™è®Šæ›´ */
        }

        .bitrate-display { font-family: 'Consolas', monospace; font-size: 19px; font-weight: bold; color: #1d4ed8; }

        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 22px; margin-top: 35px; }
        .card { background: var(--primary); color: white; padding: 30px; border-radius: 16px; text-align: center; }
        .card h4 { margin: 0 0 12px; font-size: 1.05rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 1px; }
        .card .value { font-size: 3rem; font-weight: 800; margin: 10px 0; color: #7dd3fc; }
        .card .sub { font-size: 1rem; opacity: 0.9; }
        .card.result-highlight { background: linear-gradient(135deg, #1d4ed8, #2563eb); transform: translateY(-8px); box-shadow: 0 15px 30px rgba(37,99,235,0.3); }

        .add-btn { background: var(--accent); color: white; border: none; padding: 16px 32px; border-radius: 12px; font-size: 1.15rem; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .add-btn:hover { background: #1d4ed8; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(37,99,235,0.3); transition: 0.3s; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2>é›™å‘ç›£æ§è¨ˆç®—æ©Ÿ</h2>
        <div class="badge">SI å¯¦æˆ°ç‰ˆ V4.2</div>
    </header>

    <div class="mode-switcher">
        <button class="mode-btn active" id="btnModeDays" onclick="setMode('days')">
            æŒ‡å®šå¤©æ•¸ â†’ ç®—å®¹é‡
        </button>
        <button class="mode-btn" id="btnModeStorage" onclick="setMode('storage')">
            æŒ‡å®šç¡¬ç¢Ÿ â†’ ç®—å¤©æ•¸
        </button>
    </div>

    <div class="input-section">
        <div class="input-group">
            <label id="inputLabel">é è¨ˆéŒ„å½±å¤©æ•¸ (Days)</label>
            <input type="number" id="mainInput" value="30" min="1">
            <span id="inputUnit">å¤©</span>
        </div>
        <div style="color:#475569; font-size:0.95rem;">
            è‡ªå‹•åŒ…å« 10% ç³»çµ±ç·©è¡ + æ ¼å¼åŒ–è€—æ
        </div>
    </div>

    <div class="table-responsive">
        <table id="calcTable">
            <thead>
                <tr>
                    <th width="150">å€åŸŸ</th>
                    <th width="220">è§£æåº¦ (Resolution)</th>
                    <th width="220">å£“ç¸®æ–¹å¼ (Codec)</th>
                    <th width="100">å¼µæ•¸ (FPS)</th>
                    <th width="110">æ•¸é‡</th>
                    <th width="100">å–®æ”¯ç¢¼æµ</th>
                    <th width="30">åˆªé™¤</th>
                </tr>
            </thead>
            <tbody id="cameraRows"></tbody>
        </table>
    </div>

    <button class="add-btn" onclick="addRow()">+ æ–°å¢é¡é ­ç¾¤çµ„</button>

    <div class="dashboard">
        <div class="card">
            <h4>æ‰€éœ€ç¸½é »å¯¬</h4>
            <div class="value" id="resBandwidth">0 Mbps</div>
            <div class="sub">NVR è¼¸å…¥é »å¯¬éœ€å¤§æ–¼æ­¤å€¼</div>
        </div>
        
        <div class="card result-highlight">
            <h4 id="resultTitle">ç¸½å„²å­˜ç©ºé–“éœ€æ±‚</h4>
            <div class="value" id="resMainResult">0 TB</div>
            <div class="sub" id="resultSub">å·²å«ç·©è¡èˆ‡æ ¼å¼åŒ–è€—æ</div>
        </div>

        <div class="card">
            <h4 id="suggestionTitle">ç¡¬ç¢Ÿæ¡è³¼å»ºè­°</h4>
            <div class="value" id="resSuggestion" style="color:#fbbf24; font-size:2.4rem;">-</div>
            <div class="sub">ç›£æ§å°ˆç”¨ç¢Ÿ (Purple / SkyHawk)</div>
        </div>
    </div>
</div>

<script>
    let currentMode = 'days';
    const BITRATE_BASE = { '2mp': 4096, '4mp': 8192, '5mp': 10240, '8mp': 16384 };

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('btnModeDays').className = mode === 'days' ? 'mode-btn active' : 'mode-btn';
        document.getElementById('btnModeStorage').className = mode === 'storage' ? 'mode-btn active' : 'mode-btn';

        const label = document.getElementById('inputLabel');
        const unit = document.getElementById('inputUnit');
        const input = document.getElementById('mainInput');
        if (mode === 'days') {
            label.textContent = "ğŸ“… é è¨ˆéŒ„å½±å¤©æ•¸ (Days)"; unit.textContent = "å¤©"; input.value = 30;
            document.getElementById('resultTitle').textContent = "ç¸½å„²å­˜ç©ºé–“éœ€æ±‚";
            document.getElementById('suggestionTitle').textContent = "ç¡¬ç¢Ÿæ¡è³¼å»ºè­°";
        } else {
            label.textContent = "ğŸ’¾ æ—¢æœ‰ç¡¬ç¢Ÿå®¹é‡ (HDD)"; unit.textContent = "TB"; input.value = 4;
            document.getElementById('resultTitle').textContent = "å¯éŒ„å½±å¤©æ•¸";
            document.getElementById('suggestionTitle').textContent = "éŒ„å½±è©•ä¼°";
        }
        calculateAll();
    }

    function addRow() {
        const tbody = document.getElementById('cameraRows');
        const tr = document.createElement('tr');
        // æ³¨æ„ï¼šé€™è£¡çš„ select åŠ å…¥äº† class="cell count-select qty-style"
        tr.innerHTML = `
            <td><input type="text" placeholder="ä¾‹: å¤§é–€ã€å€‰åº«" class="cell"></td>
            <td>
                <select class="cell res-select" onchange="calculateAll()">
                    <option value="2mp" selected>2MP / 1080P / 200è¬</option>
                    <option value="4mp">4MP / 1440P / 400è¬ (2K)</option>
                    <option value="5mp">5MP / 1920P / 500è¬ (3K)</option>
                    <option value="8mp">8MP / 2160P / 800è¬ (4K)</option>
                </select>
            </td>
            <td>
                <select class="cell codec-select" onchange="calculateAll()">
                    <option value="1" selected>H.264 (èˆŠæ¬¾)</option>
                    <option value="0.5">H.265 (ä¸»æµ)</option>
                    <option value="0.35">Smart H.265+ (AI)</option>
                </select>
            </td>
            <td>
                <select class="cell fps-select" onchange="calculateAll()">
                    <option value="0.5">15 FPS</option>
                    <option value="0.67">20 FPS</option>
                    <option value="1" selected>30 FPS</option>
                    <option value="2">60 FPS</option>
                </select>
            </td>
            <td>
                <select class="cell count-select qty-style" onchange="checkQty(this); calculateAll()">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="24">24</option>
                    <option value="32">32</option>
                    <option value="custom" style="background:#eff6ff; color:#2563eb; font-size:16px; font-weight:normal;">âœ è‡ªè¨‚æ•¸é‡...</option>
                </select>
            </td>
            <td style="font-size:19px;">
                <span class="bitrate-display">--</span> Kbps
            </td>
            <td>
                <button onclick="this.closest('tr').remove(); calculateAll()"
                        style="background:#ef4444; color:white; border:none; width:44px; height:44px; border-radius:50%; font-size:21px; cursor:pointer;">X</button>
            </td>
        `;
        tbody.appendChild(tr);
        calculateAll();
    }

    // è®Šèº«é­”æ³•ï¼šæ›¿æ›å¾Œçš„ input ä¹Ÿæœƒç¹¼æ‰¿ qty-style
    function checkQty(element) {
        if (element.value === 'custom') {
            const parent = element.parentElement;
            parent.innerHTML = `
                <input type="number" class="cell count-input count-input-manual qty-style" 
                       value="1" min="1" onchange="calculateAll()" placeholder="è¼¸å…¥" autofocus>
            `;
            calculateAll();
        }
    }

    function calculateAll() {
        const rows = document.querySelectorAll('#cameraRows tr');
        let totalBandwidthKbps = 0;

        rows.forEach(row => {
            const res = row.querySelector('.res-select').value;
            const codec = parseFloat(row.querySelector('.codec-select').value);
            const fps = parseFloat(row.querySelector('.fps-select').value);
            
            let countEl = row.querySelector('.count-select') || row.querySelector('.count-input');
            let count = 1;
            
            if (countEl) {
                if (countEl.value === 'custom') count = 1; 
                else count = parseInt(countEl.value) || 0;
            }

            const single = BITRATE_BASE[res] * codec * fps * 0.9;
            row.querySelector('.bitrate-display').textContent = Math.round(single).toLocaleString();
            totalBandwidthKbps += single * count;
        });

        const totalMbps = totalBandwidthKbps / 1024;
        document.getElementById('resBandwidth').textContent = totalMbps.toFixed(1) + " Mbps";

        const inputValue = parseFloat(document.getElementById('mainInput').value) || 0;

        if (currentMode === 'days') {
            const days = inputValue;
            const rawTB = (totalMbps * days * 86400) / 8 / 1024 / 1024;
            const safeTB = rawTB * 1.1;
            document.getElementById('resMainResult').textContent = safeTB.toFixed(2) + " TB";
            document.getElementById('resultSub').textContent = "å»ºè­°æ¡è³¼å®¹é‡ï¼ˆå«ç·©è¡ï¼‰";
            recommendHDD(safeTB);
        } else {
            const diskTB = inputValue;
            if (totalMbps <= 0) {
                document.getElementById('resMainResult').textContent = "âˆ å¤©"; return;
            }
            const seconds = (diskTB / 1.1 * 1024 * 1024 * 8) / totalMbps;
            const days = seconds / 86400;
            document.getElementById('resMainResult').textContent = days.toFixed(1) + " å¤©";
            document.getElementById('resultSub').textContent = `ä½¿ç”¨ ${diskTB}TB ç¡¬ç¢Ÿä¼°ç®—`;
            const sug = document.getElementById('resSuggestion');
            if (days < 7) sug.textContent = "ä½æ–¼ä¸€é€±";
            else if (days < 30) sug.textContent = "æ¨™æº–ç¯„åœ";
            else sug.textContent = "é•·æ•ˆéŒ„å½±";
            sug.style.color = days < 7 ? '#ef4444' : '#10b981';
            sug.style.fontSize = "2.4rem";
        }
    }

    function recommendHDD(tb) {
        const disks = [1,2,4,6,8,10,12,14,16,18,20,22,24];
        let text = "-";
        if (tb > 0) {
            const single = disks.find(d => d >= tb);
            if (single && single <= 24) text = `${single}TB Ã— 1`;
            else {
                const half = disks.find(d => d >= Math.ceil(tb/2));
                text = half ? `${half}TB Ã— 2` : "éœ€å¤šé¡† RAID";
            }
        }
        document.getElementById('resSuggestion').textContent = text;
    }

    document.getElementById('mainInput').addEventListener('input', calculateAll);

    window.onload = function() {
        document.getElementById('cameraRows').innerHTML = '';
        addRow();
        setMode('days');
    };
</script>

</body>
</html>
